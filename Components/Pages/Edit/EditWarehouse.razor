@page "/edit-warehouse"
@page "/edit-warehouse/{WarehouseId:int}"
@inject IWarehouseService WarehouseService
@inject NavigationManager NavigationManager
@rendermode InteractiveServer

@if (WarehouseId is null)
{
    <PageTitle>Add a New Warehouse</PageTitle>
    <h3>Add a New Warehouse</h3>
}
else if (CurrentWarehouse is not null)
{
    <PageTitle>Edit "@CurrentWarehouse.WarehouseCode"</PageTitle>
    <h3>Edit "@CurrentWarehouse.WarehouseCode"</h3>
}
else
{
    <h3>Loading...</h3>
}

<EditForm Model="CurrentWarehouse" OnSubmit="HandleSubmit">
    <div>
        <label for="title">Title</label>
        <InputText id="title" @bind-Value="CurrentWarehouse.WarehouseCode" class="form-control"/>
    </div>
    <div class="mt-3">
        <label for="location">Location</label>
        <InputText id="location" @bind-Value="CurrentWarehouse.Location" class="form-control"/>
    </div>
    <div class="mt-3">
        <button type="submit" class="btn btn-success">Save</button>
        <button type="button" class="btn btn-secondary" @onclick="Cancel">Cancel</button>
    </div>

</EditForm>


@code {
    [Parameter] public int? WarehouseId { get; set; }

    public Warehouse CurrentWarehouse { get; set; } = new();

    protected override async Task OnParametersSetAsync()
    {
        if (WarehouseId is not null)
        {
            var warehouse = await WarehouseService.GetWarehouseByIdAsync((int)WarehouseId);
            if (warehouse is not null)
            {
                CurrentWarehouse = warehouse;
            }
        }
    }

    async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(CurrentWarehouse.WarehouseCode))
        {
            Console.WriteLine("Error: Warehouse code is required.");
            return;
        }

        if (CurrentWarehouse.WarehouseCode.Length > 5)
        {
            Console.WriteLine("Error: Warehouse code must not exceed 5 characters.");
            return;
        }

        if (string.IsNullOrWhiteSpace(CurrentWarehouse.Location))
        {
            Console.WriteLine("Error: Location is required.");
            return;
        }

        if (CurrentWarehouse.Location.Length > 100)
        {
            Console.WriteLine("Error: Location must not exceed 100 characters.");
            return;
        }

        if (WarehouseId is not null)
        {
            await WarehouseService.UpdateWarehouseAsync(CurrentWarehouse, (int)WarehouseId);
        }
        else
        {
            await WarehouseService.AddWarehouseAsync(CurrentWarehouse);
        }

        NavigationManager.NavigateTo("/warehouses");
    }

    void Cancel()
    {
        NavigationManager.NavigateTo("/warehouses");
    }

}